---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Preloader from "../../components/Preloader.astro";
import LandingHeader from "../../components/LandingHeader.astro";
import GeneralFooter from "../../components/GeneralFooter.astro";
import Section from "../../components/Section.astro";
import InfoSection from "../../components/InfoSection.astro";
import PhotoSlider from "../../components/PhotoSlider.astro";
import Galery from "../../components/Galery.astro";


export async function getStaticPaths() {
    const vivienda = await getCollection("vivienda");

    return vivienda.map((casa) => ({
        params: { id: casa.slug },
        props: { casa },
    }));
}

const { casa } = Astro.props;
const { data } = casa;
const { title, description, main_img, main_video, m_array, p_array, f_array } = data;


const modelo = m_array ?? [];
const proceso = p_array ?? [];
const final = f_array ?? [];

const allImages = [...modelo, ...proceso, ...final].filter(Boolean);
---


<Layout title={title}>
    <Preloader />
    <LandingHeader />

    <!-- Presentación casa -->

    <div class="snap-center">
        <Section title={title}
                 subtitle={description}
                 color="white" 
                 bg_color = "black">

                 <img
                 slot="background"
                 class="h-full w-full object-center object-cover" 
                 src={main_img}>
    
        </Section>
    </div>

    <Galery
    title= Hola
    color = white
    bg_color = black>


    <div slot="aux_slot">
      <section>
        
<h1>{title}</h1>
<p>{description}</p>

{main_video && (
  <video controls>
    <source src={main_video} type="video/webm" />
    Tu navegador no soporta el video.
  </video>
)}

<section class="gallery">
  {allImages.map((img) => (
    <img src={img} alt="Imagen de la casa" loading="lazy" onclick="openLightbox(this.src)" />
  ))}
</section>

<!-- Lightbox -->
<dialog id="lightbox">
  <img id="lightbox-img" src="" alt="Imagen ampliada" />
  <button onclick="closeLightbox()"><div class="p-1 hover:bg-slate-300 hover:bg-opacity-40 rounded">
    <svg color=black xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="white"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
</div></button>
</dialog>

<script class="is:inline">
  function openLightbox(src) {
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");
    lightboxImg.src = src;
    lightbox.showModal();
  }

  function closeLightbox() {
    document.getElementById("lightbox").close();
  }
</script>

<style>
  .gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px;
    padding: 20px;
  }

  .gallery img {
    width: 100%;
    height: auto;
    border-radius: 10px;
    box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .gallery img:hover {
    transform: scale(1.05);
  }

  /* Lightbox */
  dialog#lightbox {
    border: none;
    background: rgba(0, 0, 0, 0.9);
    padding: 20px;
    text-align: center;
    max-width: 90vw;
    max-height: 90vh;
  }

  dialog#lightbox img {
    max-width: 100%;
    max-height: 80vh;
    border-radius: 10px;
  }

  dialog#lightbox button {
    margin-top: 10px;
    padding: ;
    background:;
    border: none;
    cursor: pointer;
    font-size: 0px;
  }
 
</style>
      </section>
    </div>
    </Galery>


    <div class="snap-center">
        <Section 
        title="¡Contáctanos ya!"
        subtitle="Haz tu proyecto realidad"
        bg_color="black"
        color="white">
                 <video 
                 slot="background" 
                 class="h-full w-full object-center object-cover" 
                 autoplay loop 
                 src={main_video}></video>

            
                 <div slot="footer">
                    <a 
                    class="border-2 rounded font-medium bg-black bg-opacity-60 
                    text-white px-10 py-2 inline-block hover:bg-white hover:bg-opacity-60
                    hover:text-black transition-colors" href="/contacto">
                        Enviar un mensaje
                    </a>
                </div>
        </Section>
    </div>

    <GeneralFooter />
</Layout>